<!DOCTYPE html>
<html>

    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Roy,Lijun,Xue,Roy Xue,Lijun Xue,薛立君">
    <meta name="author" content="">
    <link rel="shortcut icon" href="/assets/ico/favicon.ico">

    <title>Roy Xue is Here :) - Algorithm Speeding Up#GSoC2014-Theano</title>

    <!-- Bootstrap core CSS -->
    <link href="/assets/css/bootstrap.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/assets/css/style.css" rel="stylesheet">
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet">


    <script src="/assets/js/jquery-2.1.4.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/retina-1.1.0.js"></script>
    <script src="/assets/js/jquery.hoverdir.js"></script>
    <script src="/assets/js/jquery.hoverex.min.js"></script>
    <script src="/assets/js/jquery.prettyPhoto.js"></script>
    <script src="/assets/js/jquery.isotope.min.js"></script>
    <script src="/assets/js/custom.js"></script>
    <script src="/assets/js/jquery.typer.js"></script>
    <script src="/assets/js/instafeed.js"></script>

    <script src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/trianglify/0.3.1/trianglify.min.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
    <script src="/assets/js/datamaps.world.min.js"></script>
    <!-- Custom CSS -->
    <!--<link rel="stylesheet" href="/css/main.css">-->

</head>


    <body>
        <!-- Fixed navbar -->
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Roy Xue is Here :)</a>
    </div>
    <div class="navbar-collapse collapse navbar-right">
      <ul class="nav navbar-nav">
        <li ><a href="/">Home</a></li>
        <li ><a href="/blog/">Blog</a></li>
        <li ><a href="/portfolio/">Project</a></li>
        <li ><a href="/gallery/">Gallery</a></li>
        <li ><a href="/map/">Travel</a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</div>


            <div id="blue">
    <div class="container">
        <div class="row">
            <h3>Algorithm Speeding Up#GSoC2014-Theano</h3>
        </div><!-- /row -->
    </div> <!-- /container -->
</div><!-- /blue -->

<div class="container mtb">
    <div class="row">
        <!-- SINGLE POST -->
        <div class="col-lg-8">
            <!-- Blog Post  -->
            <a href="/theano/algorithm-speeding-upgsoc2014-theano"><h3 class="ctitle">Algorithm Speeding Up#GSoC2014-Theano</h3></a>
            <p><csmall>Jul 28, 2014. | By: xljroy</csmall></p>

            <p>## </p>

<hr />

<p>Recently what I done in mainly speeding up the algorithm of calculating the memory. At first I feel it is very hard for me, cause I didnt learnt much about Algorithm before, sometimes I will find it’s difficult for me to think about a faster algo.</p>

<h5 id="problem">problem</h5>

<p>About generating valid order to count the min peak peak, I use a python generator, is very fast. But the problem is that there are too many node, like in the test file. It has 11 nodes, which means there should be 11! total number of order, it’s a huge number, to generator the valid order, the code need to do maybe million times check_node_state() function, because each time when we need to check node in this order, if it is possible to “execute”. After this process we will get about 20k orders, then we have to count memory of each order and find the minimum one. This is the main part which cost lots of running time.</p>

<h5 id="solution">Solution</h5>

<p>The solution we uses has 2 parts. One is before generator, we create a set including Apply nodes that can be executed. By this step, we will reduce the check_node_state() method called times, and also reduce some generator loops.</p>

<p>On the other hand, I wrote the new simple count_min_memory() method, cause the previous count memory method do lots of unnecessary works under this situation. Actually the first idea of solving this is to count the memory during the loop. But after thinking this way in details, I found it’s not a good idea, cause it will cost much more time and also it’s difficult to generate post_thunk_of_old_storage for each node.</p>

<h5 id="result">Result</h5>

<p>using command python -m cProfile -s cumulative test_profiling.py</p>

<p><strong>Before speed</strong> 2262689 function calls (2018667 primitive calls) in 3.566 seconds</p>

<p>2262689 function calls (2018667 primitive calls) in 3.566 seconds</p>

<pre><code>&lt;code&gt;Ordered by: cumulative time

ncalls  tottime  percall  cumtime  percall filename:lineno(function)
    1    0.001    0.001    3.579    3.579 test_profiling.py:4(&lt;module&gt;)
    1    0.000    0.000    2.993    2.993 test_profiling.py:13(test_profiling)
    1    0.000    0.000    2.720    2.720 profiling.py:1002(summary)
    1    0.000    0.000    2.717    2.717 profiling.py:602(summary_memory)
    1    0.786    0.786    2.716    2.716 profiling.py:696(count_minimum_peak)
19802    0.690    0.000    1.244    0.000 profiling.py:641(count_running_memory)
    1    0.002    0.002    0.488    0.488 __init__.py:23(&lt;module&gt;)
   19    0.024    0.001    0.465    0.024 __init__.py:1(&lt;module&gt;)
261450/19801    0.305    0.000    0.432    0.000 profiling.py:782(min_memory_generator)
    1    0.001    0.001    0.301    0.301 __init__.py:29(&lt;module&gt;)
    1    0.001    0.001    0.300    0.300 scan_opt.py:3(&lt;module&gt;)
    1    0.000    0.000    0.255    0.255 function.py:15(function)
    1    0.000    0.000    0.255    0.255 pfunc.py:336(pfunc)
    1    0.000    0.000    0.254    0.254 function_module.py:1262(orig_function)
439476    0.249    0.000    0.249    0.000 {getattr}
19802    0.193    0.000    0.223    0.000 link.py:504(gc_helper)
    1    0.002    0.002    0.219    0.219 basic.py:1(&lt;module&gt;)
178301    0.215    0.000    0.215    0.000 {method 'index' of 'list' objects}
    1    0.001    0.001    0.212    0.212 elemwise.py:1(&lt;module&gt;)
    ......
&lt;/code&gt;
</code></pre>

<p><strong>After speed up</strong></p>

<pre><code>&lt;code&gt;ncalls  tottime  percall  cumtime  percall filename:lineno(function)
    1    0.001    0.001    3.272    3.272 test_profiling.py:4(&lt;module&gt;)
    1    0.000    0.000    2.791    2.791 test_profiling.py:13(test_profiling)
    1    0.000    0.000    2.514    2.514 profiling.py:1015(summary)
    1    0.000    0.000    2.511    2.511 profiling.py:602(summary_memory)
    1    0.749    0.749    2.509    2.509 profiling.py:696(count_minimum_peak)
19800    0.575    0.000    0.890    0.000 profiling.py:809(count_min_memory)
261450/19801    0.290    0.000    0.397    0.000 profiling.py:785(min_memory_generator)
   19    0.018    0.001    0.396    0.021 __init__.py:1(&lt;module&gt;)
    1    0.002    0.002    0.395    0.399 __init__.py:23(&lt;module&gt;)
    1    0.001    0.001    0.283    0.283 __init__.py:29(&lt;module&gt;)
    1    0.001    0.001    0.282    0.282 scan_opt.py:3(&lt;module&gt;)
    1    0.000    0.000    0.259    0.259 function.py:15(function)
    1    0.000    0.000    0.259    0.259 pfunc.py:336(pfunc)
    1    0.000    0.000    0.258    0.258 function_module.py:1262(orig_function)
 439476    0.238    0.000    0.238    0.000 {getattr}
 19802    0.183    0.000    0.212    0.000 link.py:504(gc_helper)
    1    0.002    0.002    0.211    0.211 basic.py:1(&lt;module&gt;)
178301    0.207    0.000    0.207    0.000 {method 'index' of 'list' objects}
......
&lt;/code&gt;
</code></pre>

<p>We can see the cost time reduced.</p>

<p>But when I tried with machine learning samples, like logistic_sgd.py the result seems not very well, it cost really lots of time. So i guess I still need to think about other ideas or design count min peak as a parameter of the function.</p>

<p>The problem is like for N apply node in our function, we will have total N! orders, and find valid order from them. When N is big, the N! is really huge, so the valid order number is also very big. If we have too many order, it cost too much time to count min memory. So maybe remove similar order is a solution to do this.</p>


            <div class="spacing"></div>
        </div><!--/col-lg-8 -->

        <div class="col-lg-4">
    <h4>Subscribe</h4>
    <div class="hline"></div>
        <p>
            <p class="rss-subscribe">Subscribe to this blog <a href="/feed.xml">via RSS</a>.</p>
        </p>
    <div class="spacing"></div>
    <h4>Categories</h4>
    <div class="hline"></div>
    
        <p>
            <a href="/category/#life"><i class="fa fa-angle-right"></i> Life</a>
            <span class="badge badge-theme pull-right">58</span>
        </p>
    
        <p>
            <a href="/category/#having fun"><i class="fa fa-angle-right"></i> Having fun</a>
            <span class="badge badge-theme pull-right">6</span>
        </p>
    
        <p>
            <a href="/category/#python"><i class="fa fa-angle-right"></i> Python</a>
            <span class="badge badge-theme pull-right">9</span>
        </p>
    
        <p>
            <a href="/category/#hacker"><i class="fa fa-angle-right"></i> Hacker</a>
            <span class="badge badge-theme pull-right">2</span>
        </p>
    
        <p>
            <a href="/category/#dev"><i class="fa fa-angle-right"></i> Dev</a>
            <span class="badge badge-theme pull-right">13</span>
        </p>
    
        <p>
            <a href="/category/#scrapy"><i class="fa fa-angle-right"></i> Scrapy</a>
            <span class="badge badge-theme pull-right">3</span>
        </p>
    
        <p>
            <a href="/category/#theano"><i class="fa fa-angle-right"></i> Theano</a>
            <span class="badge badge-theme pull-right">14</span>
        </p>
    
        <p>
            <a href="/category/#question"><i class="fa fa-angle-right"></i> Question</a>
            <span class="badge badge-theme pull-right">1</span>
        </p>
    
        <p>
            <a href="/category/#machine learning"><i class="fa fa-angle-right"></i> Machine learning</a>
            <span class="badge badge-theme pull-right">5</span>
        </p>
    
        <p>
            <a href="/category/#explorer"><i class="fa fa-angle-right"></i> Explorer</a>
            <span class="badge badge-theme pull-right">3</span>
        </p>
    
        <p>
            <a href="/category/#rails"><i class="fa fa-angle-right"></i> Rails</a>
            <span class="badge badge-theme pull-right">1</span>
        </p>
    
        <p>
            <a href="/category/#design"><i class="fa fa-angle-right"></i> Design</a>
            <span class="badge badge-theme pull-right">1</span>
        </p>
    
        <p>
            <a href="/category/#fun"><i class="fa fa-angle-right"></i> Fun</a>
            <span class="badge badge-theme pull-right">1</span>
        </p>
    

    <div class="spacing"></div>

    <h4>Recent Posts</h4>
    <div class="hline"></div>
        <ul class="popular-posts">
             
                <li>
                    <p><a href="/blog/life/never-better-never-worse">Never Better, Never Worse</a></p>
                <em>Posted on 22 Apr 2015</em>
            </li>
             
                <li>
                    <p><a href="/blog/life/good-photo">好照片</a></p>
                <em>Posted on 18 Apr 2015</em>
            </li>
             
                <li>
                    <p><a href="/blog/dev/fun/build-minecraft-server-on-digitalocean">Build Minecraft Server on DigitalOcean</a></p>
                <em>Posted on 14 Apr 2015</em>
            </li>
             
                <li>
                    <p><a href="/blog/design/first-time-icon-design">First Time Icon Design</a></p>
                <em>Posted on 12 Apr 2015</em>
            </li>
             
        </ul>

    <div class="spacing"></div>

</div>

    </div><!--/row -->
</div><!--/container -->


        <div id="footerwrap">
    <div class="container">
        <div class="row">
            <div class="col-lg-4">
                <h4>About</h4>
                <div class="hline-w"></div>
                <p>Exploring the world :)</p>
            </div>
            <div class="col-lg-4">
                <h4>Social Links</h4>
                <div class="hline-w"></div>
                <p>
                    
                        <a href="https://www.facebook.com/roy.xue29" class="btn-social btn-outline"><i class="fa fa-facebook"></i></a>
                    
                        <a href="https://twitter.com/xljroy" class="btn-social btn-outline"><i class="fa fa-twitter"></i></a>
                    
                        <a href="http://instagram.com/xljroy" class="btn-social btn-outline"><i class="fa fa-instagram"></i></a>
                    
                        <a href="https://plus.google.com/+RoyXue" class="btn-social btn-outline"><i class="fa fa-google-plus"></i></a>
                    
                        <a href="https://cn.linkedin.com/in/royxue" class="btn-social btn-outline"><i class="fa fa-linkedin"></i></a>
                    
                        <a href="https://github.com/royxue" class="btn-social btn-outline"><i class="fa fa-github"></i></a>
                    
                        <a href="https://500px.com/xljroy" class="btn-social btn-outline"><i class="fa fa-picture-o"></i></a>
                    
                </p>
            </div>
            <div class="col-lg-4">
                <h4>Contacts</h4>
                <div class="hline-w"></div>
                <p>
                    
                        Email=> xljroy#gmail.com <br>
                    
                        Wechat=> xljroy <br>
                    
                        Line=> royxue29 <br>
                    
                </p>
            </div>
        </div><!--/row -->
    </div><!--/container -->
</div><!--/footerwrap -->

        
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58877422-1', 'auto');
  ga('send', 'pageview');

</script>

<script>
// Portfolio
(function($) {
	"use strict";
	var $container = $('.portfolio'),
		$items = $container.find('.portfolio-item'),
		portfolioLayout = 'fitRows';
		if( $container.hasClass('portfolio-centered') ) {
			portfolioLayout = 'masonry';
		}
		$container.isotope({
			filter: '*',
			animationEngine: 'best-available',
			layoutMode: portfolioLayout,
			animationOptions: {
			duration: 750,
			easing: 'linear',
			queue: false
		},
		masonry: {
		}
		}, refreshWaypoints());

		function refreshWaypoints() {
			setTimeout(function() {
			}, 1000);
		}

		$('nav.portfolio-filter ul a').on('click', function() {
				var selector = $(this).attr('data-filter');
				$container.isotope({ filter: selector }, refreshWaypoints());
				$('nav.portfolio-filter ul a').removeClass('active');
				$(this).addClass('active');
				return false;
		});

		function getColumnNumber() {
			var winWidth = $(window).width(),
			columnNumber = 1;

			if (winWidth > 1200) {
				columnNumber = 5;
			} else if (winWidth > 950) {
				columnNumber = 4;
			} else if (winWidth > 600) {
				columnNumber = 3;
			} else if (winWidth > 400) {
				columnNumber = 2;
			} else if (winWidth > 250) {
				columnNumber = 1;
			}
				return columnNumber;
			}

			function setColumns() {
				var winWidth = $(window).width(),
				columnNumber = getColumnNumber(),
				itemWidth = Math.floor(winWidth / columnNumber);
				$container.find('.portfolio-item').each(function() {
					$(this).css( {
					width : itemWidth + 'px'
				});
			});
		}

		function setPortfolio() {
			setColumns();
			$container.isotope('reLayout');
		}

		$container.imagesLoaded(function () {
			setPortfolio();
		});

		$(window).on('resize', function () {
		setPortfolio();
	});
})(jQuery);
</script>
<script>
  $(function () {
    $('[data-typer-targets]').typer();
  });
</script>
    </body>
</html>